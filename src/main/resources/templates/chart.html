<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Моделирование ввода пищи</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" th:inline="javascript">
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawCharts);

        function drawCharts() {
            drawDistributionCharts();
            drawAbsorptionChart();
        }

        function drawDistributionCharts() {
            var tDistributionValues = [[${tDistributionValues}]];
            var d1DistributionValues = [[${d1DistributionValues}]];
            var d2DistributionValues = [[${d2DistributionValues}]];

            var data1 = new google.visualization.DataTable();
            data1.addColumn('number', 't');
            data1.addColumn('number', 'D1');
            for (var i = 0; i < tDistributionValues.length; i++) {
                data1.addRow([tDistributionValues[i], d1DistributionValues[i]]);
            }

            var data2 = new google.visualization.DataTable();
            data2.addColumn('number', 't');
            data2.addColumn('number', 'D2');
            for (var i = 0; i < tDistributionValues.length; i++) {
                data2.addRow([tDistributionValues[i], d2DistributionValues[i]]);
            }

            var options1 = {
                title: 'Количество глюкозы (D1, mmol) в желудке',
                curveType: 'function',
                hAxis: { title: 't' },
                vAxis: { title: 'D1' },
                legend: 'none'
            };

            var options2 = {
                title: 'Количество глюкозы (D2, mmol) в кишечнике',
                curveType: 'function',
                hAxis: { title: 't' },
                vAxis: { title: 'D2' },
                legend: 'none'
            };

            var chart1 = new google.visualization.LineChart(document.getElementById('distribution_chart1'));
            chart1.draw(data1, options1);

            var chart2 = new google.visualization.LineChart(document.getElementById('distribution_chart2'));
            chart2.draw(data2, options2);
        }

        function drawAbsorptionChart() {
            var tAbsorptionValues = [[${tAbsorptionValues}]];
            var uGAbsorptionValues = [[${uGAbsorptionValues}]];

            var data = new google.visualization.DataTable();
            data.addColumn('number', 't');
            data.addColumn('number', 'UG');
            for (var i = 0; i < tAbsorptionValues.length; i++) {
                data.addRow([tAbsorptionValues[i], uGAbsorptionValues[i]]);
            }

            var options = {
                title: 'Показатель абсорции глюкозы (UG, mmol/min)',
                curveType: 'function',
                hAxis: { title: 't' },
                vAxis: { title: 'UG' },
                legend: 'none'
            };

            var chart = new google.visualization.LineChart(document.getElementById('absorption_chart'));
            chart.draw(data, options);
        }
    </script>
</head>
<body>
<h1>Моделирование ввода пищи</h1>
<form action="#" th:action="@{/glucose/subsystem}" method="post">
    <label for="carbs">Употребленные углеводы (грамм):</label>
    <input type="text" id="carbs" name="carbs" required>
    <br/>
    <br/>
    <label for="duration">Продолжительность приема пищи (минут):</label>
    <input type="text" id="duration" name="duration" required>
    <br/>
    <br/>
    <button type="submit">Смоделировать</button>
</form>
<div id="distribution_chart1" style="width: 900px; height: 500px"></div>
<div id="distribution_chart2" style="width: 900px; height: 500px"></div>
<div id="absorption_chart" style="width: 900px; height: 500px"></div>
</body>
</html>
